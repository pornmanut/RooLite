{
  "state_tracking": {
    "required_states": {
      "system": {
        "current_mode": {
          "type": "string",
          "required": true,
          "validation": "valid_mode"
        },
        "loaded_modules": {
          "type": "array",
          "required": true,
          "validation": "modules_exist"
        },
        "project_root": {
          "type": "string",
          "required": true,
          "validation": "directory_exists"
        }
      },
      "mode": {
        "available_tools": {
          "type": "array",
          "required": true,
          "validation": "tools_exist"
        },
        "file_permissions": {
          "type": "object",
          "required": true,
          "validation": "valid_permissions"
        },
        "context": {
          "type": "object",
          "required": true,
          "validation": "context_valid"
        }
      },
      "mcp": {
        "connected_servers": {
          "type": "array",
          "required": true,
          "validation": "servers_available"
        },
        "server_states": {
          "type": "object",
          "required": true,
          "validation": "states_valid"
        },
        "available_tools": {
          "type": "object",
          "required": true,
          "validation": "tools_available"
        }
      },
      "task": {
        "current_task": {
          "type": "object",
          "required": true,
          "validation": "task_valid"
        },
        "task_history": {
          "type": "array",
          "required": true
        }
      }
    },
    "state_transitions": {
      "mode_switch": {
        "required_checks": [
          "target_mode_valid",
          "context_preservable",
          "tools_available"
        ],
        "preserve_states": [
          "system.project_root",
          "task.current_task",
          "task.task_history",
          "mcp.connected_servers"
        ],
        "clear_states": [
          "mode.available_tools",
          "mode.file_permissions"
        ],
        "update_states": [
          "system.current_mode",
          "system.loaded_modules",
          "mode.context"
        ]
      },
      "mcp_operation": {
        "required_checks": [
          "server_connected",
          "tool_available",
          "params_valid"
        ],
        "preserve_states": [
          "system.*",
          "mode.*",
          "task.*"
        ],
        "track_changes": [
          "server_state_changes",
          "tool_usage_stats"
        ]
      }
    },
    "validation_rules": {
      "servers_available": {
        "check": "verify_server_connections",
        "error": "No MCP servers available"
      },
      "states_valid": {
        "check": "verify_server_states",
        "error": "Invalid server states"
      },
      "tools_available": {
        "check": "verify_tool_availability",
        "error": "Required tools not available"
      }
    }
  },
  "state_persistence": {
    "persist": [
      "task.task_history",
      "system.project_root",
      "mcp.connected_servers"
    ],
    "volatile": [
      "mode.available_tools",
      "mode.context",
      "mcp.server_states"
    ],
    "cleanup_on_exit": [
      "temporary_files",
      "mode_specific_cache",
      "server_connections"
    ]
  },
  "consistency_checks": {
    "pre_operation": [
      "state_complete",
      "state_valid",
      "resources_available",
      "servers_connected"
    ],
    "post_operation": [
      "state_consistent",
      "resources_cleaned",
      "context_preserved",
      "connections_maintained"
    ],
    "periodic": [
      "system_health",
      "resource_usage",
      "state_integrity",
      "server_health"
    ]
  }
}